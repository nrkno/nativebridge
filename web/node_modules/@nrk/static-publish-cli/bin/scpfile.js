/* eslint-disable no-sync, consistent-return */
const fs = require('fs');
const scpClient = require('scp2');

module.exports = (options, callback) => {
  const scpOptions = {
    host: options.cdnHostName,
    username: options.cdnUsername,
    privateKey: fs.readFileSync(options.cdnPrivateKeyPath),
    passphrase: options.cdnPrivateKeyPassphrase,
    path: options.remoteDir
  };
  try {
    scpClient.scp(options.archive, scpOptions, (err) => {
      if (err) {
        return callback(err);
      }
      return callback();
    });
  } catch(e) {
    return callback(e);
  }
};
